
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>
    
  QDaily appæµé‡å’Œæ–‡ç« æ‰“å¼€é€Ÿåº¦ä¼˜åŒ–--jså’Œcssçš„åŠ è½½é€»è¾‘ - é‡ç«ğŸ”¥
  

  </title>
  <meta name="author" content="">
  <meta name="description" content="ç”Ÿå‘½å¦‚é‡ç«ï¼Œéª„å‚²è€Œé¡½å¼º">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="asset/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="atom.xml" rel="alternate" title="é‡ç«ğŸ”¥" type="application/atom+xml">
  <script src="asset/js/modernizr-2.0.js"></script>
  <script src="asset/js/jquery.min.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/solarized_light.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>

  <style type="text/css">
  .cat-children-p{ padding: 6px 0px;}
  .hljs{background: none;}
  </style>
  <script type="text/javascript">
  var isAddSildbar = true;
  </script>
  <script src="asset/js/octopress.js" type="text/javascript"></script>
</head>
<script type="text/javascript">
//é“¾æ¥æ–°å¼€çª—å£
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
  });
}
$(document).ready(function(event) {
  addBlankTargetForLinks();
});
</script>
<body   >
  <header role="banner"><hgroup>
  <h1><a href="index.html">é‡ç«ğŸ”¥</a></h1>
  
    <h2>ç”Ÿå‘½å¦‚é‡ç«ï¼Œéª„å‚²è€Œé¡½å¼º</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.chaisong.xyz" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">

  <li id=""><a target="_self" href="index.html">Home</a></li>

  <li id=""><a target="_self" href="archives.html">Archives</a></li>

  <li id=""><a target="_self" href="aboutme.html">ABOUT ME</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content"> 
<div>
	<article class="hentry" role="article">
	<header>
			  	<h1 class="entry-title">QDaily appæµé‡å’Œæ–‡ç« æ‰“å¼€é€Ÿåº¦ä¼˜åŒ–--jså’Œcssçš„åŠ è½½é€»è¾‘</h1>
				<p class="meta"><time datetime="2016-09-12T23:01:13+08:00" pubdate data-updated="true">2016/9/12</time></p>
			 </header>
		  	<div class="entry-content">
			  	<hr/>

<blockquote>
<p>æœ¬æ–‡å±äºâ€œå¥½å¥‡å¿ƒæ—¥æŠ¥appçš„æµé‡å’Œæ–‡ç« æ‰“å¼€é€Ÿåº¦ä¼˜åŒ–â€ç³»åˆ—æ–‡ç« ç¬¬äºŒç¯‡ï¼Œä¸»è¦ä»‹ç»ä¸ºå®ç°æ–‡ç« å°½å¿«çš„æ‰“å¼€é€Ÿåº¦è€Œè¿›è¡Œçš„jså’Œcssçš„é¢„è½½å’Œç¼“å­˜ä»¥åŠé‡ç”¨çš„é€»è¾‘ã€‚</p>

<p>æ•´ç¯‡ä»£ç å‡ä¸ºObjective-Cï¼ŒAndroidå¯ä»¥å‚è€ƒä¹¦å†™ã€‚</p>
</blockquote>

<h2 id="toc_0">å‰è¨€</h2>

<p>å¥½å¥‡å¿ƒæ—¥æŠ¥æ‰€æœ‰æ–‡ç« éƒ½æ˜¯è‡ªäº§ï¼Œjså’Œcssæ–‡ä»¶åœ¨æ‰€æœ‰æ–‡ç« ä¸­éƒ½ä½¿ç”¨çš„ä¸€å¥—è¿›è¡Œé€»è¾‘å’Œæ ·å¼å¤„ç†ã€‚åœ¨æ¯æ¬¡å‰ç«¯åŒäº‹ä¿®æ”¹äº†jsæˆ–è€…cssä»£ç åï¼Œä¼šç»™è¯¥æ–‡ä»¶ç›´æ¥ç”Ÿæˆä¸€ä¸ª64ä½çš„hashcodeé™„åœ¨å…¶åï¼Œä»¥åŒºåˆ†ä¸åŒç‰ˆæœ¬ï¼Œç”¨äºæµè§ˆå™¨ç«¯æ›´æ–°ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</p>

<pre><code class="language-text">    http://app3.qdaily.com/assets/app3/common-bc6aa258d92609720eb97f34f86f978367bd3d849c9c0bbc82feeed9e79b6623.js
</code></pre>

<p>å…¶ä¸­ä¸»è¦åŒ…æ‹¬common.jsã€show.jsã€common.csså’Œshow.csså››ä¸ªæ–‡ä»¶ã€‚</p>

<span id="more"></span><!-- more -->

<h2 id="toc_1">é¢„è½½é€»è¾‘(æ­¤å¤„é‡‡ç”¨çš„ä¸ºUIWebView)</h2>

<p>é¦–å…ˆéœ€è¦è¯´ç¥å¥‡çš„NSURLCacheï¼Œè¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§ç®¡ç†æ¯”è¾ƒå®Œå–„çš„diskå’Œmemoryå…¼æœ‰çš„ç¼“å­˜ç®¡ç†ã€‚appä¸­çš„æ‰€æœ‰urlè¯·æ±‚ï¼Œåªè¦å…¶cachePolicyè®¾ç½®äº†UseProtocolCachePolicyã€ReturnCacheDataElseLoadã€ReturnCacheDataDontLoadï¼Œæˆ–è€…æ²¡æœ‰è®¾ç½®ï¼Œéƒ½ä¼šèµ°NSURLCacheçš„ä¸‹é¢ä¸¤ä¸ªtemplateæ–¹æ³•ï¼š</p>

<pre><code class="language-text">- (NSCachedURLResponse *)cachedResponseForRequest:(NSURLRequest *)request;
- (void)storeCachedResponse:(NSCachedURLResponse *)cachedResponse forRequest:(NSURLRequest *)request;
</code></pre>

<p>ä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«å¤„ç†cacheçš„è¯»å–å’Œå­˜å‚¨ã€‚appä¸­å¯ä»¥è‡ªå®šä¹‰NSURLCacheçš„æ´¾ç”Ÿç±»ï¼Œåˆå§‹åŒ–è¯¥å¯¹è±¡ï¼Œç„¶åé€šè¿‡[NSURLCache setSharedURLCache:cache]æ–¹æ³•å®ç°è®¾ç½®ã€‚è¿™é‡Œå…¶å®å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä»£ç†æ¨¡å¼äº†ã€‚</p>

<ul>
<li>1ã€è¯·æ±‚</li>
</ul>

<p>åœ¨å¤„ç†UIWebViewå¯¹jså’Œcssçš„requestæ—¶ï¼Œä¼šå…ˆèµ°cachedResponseForRequestæ–¹æ³•ï¼Œæ­¤å¤„æˆ‘ä»¬éœ€è¦åˆ¤æ–­è¯¥requestçš„UAæ˜¯å¦åŒ…å«â€œAppleWebKitâ€æ¥ç¡®è®¤æ˜¯å¦è¯·æ±‚æ¥è‡ªäºä¸€ä¸ªWebViewã€‚</p>

<p>æ­¤å¤„æˆ‘ä»¬è‡ªè¡Œåˆ¤æ–­ï¼Œå¦‚æœæœ¬åœ°ç»´æŠ¤çš„ç¼“å­˜å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥cache dataï¼Œè‹¥ä¸å­˜åœ¨ï¼Œè¿”å›nilï¼ŒUIWebViewä¼šè‡ªå·±å»èµ°ç½‘ç»œåŠ è½½ã€‚</p>

<ul>
<li>2ã€å­˜å‚¨</li>
</ul>

<p>UIWebViewè‡ªå·±è¯·æ±‚çš„æ•°æ®åœ¨å®Œæˆåï¼Œä¼šå›è°ƒstoreCachedResponse:forRequestæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå›è°ƒç½‘ç»œå›æ¥çš„NSDataï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å­˜å‚¨åœ¨è‡ªå·±ç»´æŠ¤çš„ç¼“å­˜ç›®å½•ï¼Œä»¥ä¾›ä¸‹æ¬¡è¯»å–ã€‚</p>

<p>æ³¨æ„ï¼Œæ­¤å¤„å­˜å‚¨çš„requestä¹Ÿè¦åˆ¤æ–­å…¶UAæ˜¯å¦åŒ…å«â€œAppleWebKitâ€ã€‚</p>

<ul>
<li>3ã€é¢„è½½</li>
</ul>

<p>ä¸ºäº†æ›´å¥½çš„æ‰“å¼€ä½“éªŒï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡è¿›å…¥appé¦–é¡µæƒ…å†µä¸‹ï¼Œå¦‚æœè¯¥ç”¨æˆ·åœ¨wifiæ¡ä»¶ï¼Œä¼šè‡ªåŠ¨è¯·æ±‚ä¸‹è½½æœ€æ–°çš„jså’Œcssæ–‡ä»¶ï¼Œç„¶åå­˜å‚¨åˆ°å¯¹åº”çš„Cacheç›®å½•ï¼Œç”¨äºä¼˜åŒ–æ–‡ç« æ‰“å¼€é€Ÿåº¦å’Œæµé‡ã€‚</p>

<p>ä¸Šé¢çš„æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š<br/>
<img src="media/15378876731775/blog_WebViewJS-CSSCache1.jpg" alt="blog_WebViewJS-CSSCache1"/></p>

<p>æœ‰ä¸€ä¸ªé‡è¦çš„æ³¨æ„ç‚¹ï¼Œ[NSURLCache setSharedURLCache:cache]æ–¹æ³•è°ƒç”¨ä¸€å®šè¦<code>åœ¨æ‰€æœ‰çš„ç½‘ç»œå‘é€ä¹‹å‰</code>ï¼Œå¦åˆ™ä¼šé€ æˆä»¥åçš„å›è°ƒæ–¹æ³•ä¸èƒ½æ­£ç¡®çš„è°ƒç”¨çš„æƒ…å†µï¼Œä½¿å¾—ç¼“å­˜å¤±æ•ˆã€‚</p>

<h2 id="toc_2">hashcodeéªŒè¯æœºåˆ¶</h2>

<h4 id="toc_3">ä»¥ä¸Šæ–¹æ¡ˆé‡åˆ°çš„é—®é¢˜</h4>

<p>ä¸Šé¢çš„é¢„è½½æœºåˆ¶åœ¨å¥½å¥‡å¿ƒæ—¥æŠ¥å®æ–½äº†1å¹´ï¼Œåœ¨æé«˜appæ‰“å¼€é€Ÿåº¦å’Œä¼˜åŒ–æµé‡æ–¹é¢å‘æŒ¥äº†å¾ˆå¤šä½œç”¨ã€‚ä¸ºäº†è¿›ä¸€æ­¥æé«˜æ–‡ç« æ‰“å¼€é€Ÿåº¦å’ŒèŠ‚çº¦æµé‡ï¼Œä¸Šä¸ªæœˆæˆ‘ä»¬åœ¨æ–‡ç« ä¸Šçº¿äº†å›¾ç‰‡çš„å»¶è¿ŸåŠ è½½æœºåˆ¶ã€‚å°±æ˜¯htmlä¸­çš„imgæ ‡ç­¾çš„srcå­—æ®µå…ˆæŒ‡å‘ä¸€ä¸ªç©ºç™½å›¾ï¼Œåªæœ‰åœ¨å½“å‰å†…å®¹åœ¨å‡ºç°çš„å±å¹•ä¸­æ‰ä¼šåŠ¨æ€æ›¿æ¢srcä¸ºçœŸå®å›¾ç‰‡ã€‚å»¶è¿ŸåŠ è½½åï¼Œæ–‡ç« æ‰“å¼€é£å¿«ï¼Œå¦‚æœç”¨æˆ·æ‰“å¼€åä¸å–œæ¬¢ï¼Œé€€å‡ºä¹Ÿä¸ä¼šåŠ è½½æ›´å¤šå›¾ç‰‡ã€‚ä½†è¿™æ ·å´å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼š</p>

<pre><code class="language-text">imgæ ‡ç­¾çš„srcæ›¿æ¢æœºåˆ¶å…¨åœ¨jsä»£ç ä¸­ï¼Œå¦‚æœç”±äºæŸç§åŸå› ï¼ˆç½‘ç»œè´¨é‡æŸ¥ï¼ŒåŠ«æŒï¼Œjsåæ‰äº†ï¼‰ï¼Œå¯¼è‡´jsä»£ç å‡ºç°é—®é¢˜ï¼Œåˆ™æ‰€æœ‰æ­£æ–‡å›¾ç‰‡å°±å…¨éƒ¨æ— æ³•æµè§ˆã€‚
</code></pre>

<p>å»¶è¿ŸåŠ è½½æœºåˆ¶å’Œæˆ‘ä»¬çš„WebPå›¾ç‰‡è´¨é‡å‹ç¼©æ–¹æ¡ˆä¸€èµ·ä¸Šçº¿ï¼ŒåˆæœŸå‡ºç°äº†ä¸é”™çš„æ•ˆæœï¼Œä½†åç»­å‡ºç°ä¸‰ä¸‰ä¸¤ä¸¤çš„åé¦ˆï¼Œè¯´æ— æ³•çœ‹åˆ°æ‰€æœ‰æ­£æ–‡å›¾ç‰‡ã€‚å¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘ä»¬éƒ½æ€€ç–‘æ˜¯ç”±äºWebPå¯¼è‡´çš„æ— æ³•æŸ¥çœ‹ï¼Œæ¯•ç«ŸiPhoneçš„UIWebViewé»˜è®¤æ˜¯ä¸æ”¯æŒWebPçš„ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåšäº†ä¸€äº›é»‘ç§‘æŠ€å¼çš„å¤„ç†ï¼Œå­˜åœ¨bugä¹Ÿæ˜¯å¯èƒ½çš„ã€‚å› æ‰€æœ‰æµ‹è¯•æ‰‹æœºã€åŒäº‹æ‰‹æœºéƒ½æ²¡æœ‰å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œbugå®šä½éå¸¸è‰°éš¾ã€‚æˆ‘ä»¬é€šè¿‡ä¸‹å‘ç”¨æˆ·patchä»£ç ï¼Œæ‹‰å»ç”¨æˆ·æ—¥å¿—ï¼Œè”ç³»ç”¨æˆ·ä¸»åŠ¨æˆªå±ï¼Œç»ˆäºè‰°éš¾å®šä½äº†åŸå› ï¼Œç«Ÿç„¶æ˜¯å»¶è¿ŸåŠ è½½å¯¼è‡´çš„ï¼éƒ¨åˆ†ç½‘ç»œæƒ…å†µå¯¹æˆ‘ä»¬çš„jsæ–‡ä»¶è¯·æ±‚è¿›è¡Œäº†DNSåŠ«æŒï¼Œå¯¼è‡´jsæ–‡ä»¶æŸåï¼</p>

<p>å›¾ç‰‡å»¶è¿ŸåŠ è½½æ˜¯éå¸¸é‡è¦çš„ä¼˜åŒ–ç‰¹æ€§ï¼Œè‚¯å®šä¸èƒ½å›æ»šè¯¥æœºåˆ¶ã€‚å®¢æˆ·ç«¯åœ¨è¿™é‡Œå°±ä¸€å®šè¦åšjsæ–‡ä»¶çš„æ­£ç¡®æ€§éªŒè¯ã€‚è¿™é‡Œæ­£å¥½æœ‰æœåŠ¡ç«¯è¿”å›çš„hashcodeåœ¨urlä¸­ï¼Œå¯ä»¥ç›´æ¥è¿›è¡ŒéªŒè¯ä½¿ç”¨ã€‚</p>

<p>ä¸ºä¿®å¤è¿™é‡Œçš„å¯èƒ½å‡ºç°çš„ç½‘ç»œé—®é¢˜ï¼Œä¿®æ”¹è¿™é‡Œçš„é€»è¾‘ï¼š</p>

<ul>
<li>1ã€appæ–°ç‰ˆæ‰“åŒ…éœ€è¦æ‰“åŒ…è¿›å»æœ€æ–°çš„jså’Œcssæ–‡ä»¶ã€‚</li>
<li>2ã€æ¯æ¬¡è¿›è¡Œé¢„è½½æˆ–è€…UIWebViewè‡ªå·±çš„ç½‘ç»œè¯·æ±‚å®Œæˆåï¼Œå…ˆéªŒè¯ä¸‹è½½æ–‡ä»¶çš„hashCodeæ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœä¸æ­£ç¡®ï¼Œè¦è¿”å›æœ¬åœ°æœ€è¿‘çš„ç¼“å­˜ç‰ˆæœ¬ï¼Œå¦‚æœæ²¡æœ‰ç¼“å­˜è¿‡åˆ™ç›´æ¥è¿”å›bundleå†…çš„æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬è®¤ä¸ºä¸€ä¸ªé”™è¯¯çš„æ–°ç‰ˆjså’Œcssæ–‡ä»¶è¿˜ä¸å¦‚ç”¨ä¸€ä¸ªè€ç‰ˆçš„æ–‡ä»¶ã€‚</li>
<li>3ã€åªæœ‰ä¸‹è½½åhashCodeæ­£ç¡®çš„æ–‡ä»¶æ‰èƒ½æ”¾è¿›ç¼“å­˜ç›®å½•</li>
</ul>

<p>é¦–å…ˆå®šä¹‰ä¸¤ä¸ªå·¥å…·å‹æ–¹æ³•ï¼š</p>

<ul>
<li><p>æ–¹æ³•1ï¼š</p>
<pre><code class="language-text">/**
 *  æ–¹æ³•ç”¨äºåˆ¤æ–­requestæ˜¯å¦éœ€è¦å¤„ç†<br/>
 *<br/>
 *  @param request<br/>
 *  åŸŸåä¸º                  qdaily.com<br/>
 *  UAåŒ…å«                 AppleWebKit<br/>
 *  extensionä¸º           jsæˆ–è€…css<br/>
 *  urlè§„åˆ™ä¸º               http://url/name-hashcode.ext<br/>
 *  ä¸Šé¢urlä¸­hashcodeä¸º64ä½<br/>
 *  @return YESè¡¨ç¤ºç¬¦åˆéªŒè¯è§„åˆ™<br/>
 */<br/>
+(BOOL) shouldVerifyHashCode:(NSURLRequest*) request;
</code></pre></li>
<li><p>æ–¹æ³•2ï¼š</p>
<pre><code class="language-text">/**
 *  æ–¹æ³•ç”¨æˆ·è·å–ç¼“å­˜æ•°æ®<br/>
 *<br/>
 *  @param url      ç½‘ç»œè¯·æ±‚çš„url<br/>
 *  @param hashCode æ–‡ä»¶æ­£ç¡®çš„hashCode<br/>
 *  @param verify   æ–‡ä»¶æ˜¯å¦éœ€è¦éªŒè¯hashCode<br/>
 *  é€šè¿‡urlè·å–nameï¼ŒæŒ‰é¡ºåºæŸ¥sandboxå’Œapp mainbundleï¼Œæ²¡æœ‰è¿”å›nilã€‚<br/>
 *  å¦‚æœverifyä¸ºNOï¼Œç›´æ¥è¿”å›ä¸Šé¢çš„æ–‡ä»¶ã€‚<br/>
 *  verifyä¸ºYESï¼ŒéªŒè¯ä¸Šé¢çš„æ–‡ä»¶çš„hashcodeæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å›ä¸Šé¢æ–‡ä»¶ï¼Œä¸ç­‰è¿”å›nilã€‚<br/>
 *  @return ç¼“å­˜data OR nil<br/>
 */<br/>
+(NSData*) cacheFromUrl:(NSString*) url hashCode:(NSString*)hashCode verify:(BOOL)verify;
</code></pre></li>
</ul>

<p>å› ä¸ºéœ€æ±‚é€»è¾‘æ”¹å˜ï¼Œä½¿ç”¨NSURLCacheå·²ç»æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†iOSä¸­çš„å¦ä¸€ä¸ªé»‘ç§‘æŠ€ç±»NSURLProtocolã€‚è¿™ä¸ªæ˜¯æ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚éƒ½ä¼šèµ°çš„ä¸€ä¸ªç±»ï¼Œä¸€èˆ¬ç”¨äºç½‘ç»œæ‹¦æˆªã€ç»‘å®šåªç”¨ã€‚æˆ‘ä»¬è¿‡å»åœ¨è¿™é‡Œä¸ºiPadç”¨æˆ·çš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚ç»‘å®šè¿‡ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œä¸”WebPçš„UIWebViewæ”¯æŒä¹Ÿæ˜¯åœ¨è¿™é‡Œåšçš„å¤„ç†ã€‚åŸºæœ¬é€»è¾‘å›¾å¦‚ä¸‹ï¼š</p>

<p><img src="media/15378876731775/blog_1473656205.jpg" alt="blog_1473656205"/></p>

<p>ç›¸åº”çš„ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œç½‘ç»œWiFiæ¡ä»¶ä¸‹é¢„åŠ è½½jså’Œcssæ–‡ä»¶æ—¶å€™ï¼Œåœ¨ä¸‹è½½å®Œæˆä¹Ÿéœ€è¦è¿›è¡ŒhashCodeçš„åˆ¤æ–­ï¼Œå¦‚æœæ­£ç¡®æ‰å¯ä»¥è¿›è¡Œç¼“å­˜ã€‚</p>

<h4 id="toc_4">iOSéƒ¨åˆ†å®ç°çš„å…³é”®ä»£ç </h4>

<ul>
<li>1ã€è·å–æ–‡ä»¶çš„SHA256</li>
</ul>

<pre><code class="language-objectivec">//æ‰€æœ‰çš„ä¸‹è½½å®Œæˆéƒ½èµ°è¿™é‡Œ
+ (NSString*)SHA256HashCodeWithURL:(NSURL*)URL {
    NSData* dataIn = [NSData dataWithContentsOfURL:URL];
    return [QFileDownloader SHA256HashCode:dataIn];
}

//æ‰€æœ‰çš„æœ¬åœ°è¯»å–éƒ½èµ°è¿™é‡Œ
+ (NSString*)SHA256HashCodeWithFilePath:(NSString*)filePath {
    NSData* dataIn = [NSData dataWithContentsOfFile:filePath];
    return [QFileDownloader SHA256HashCode:dataIn];
}

+ (NSString*)SHA256HashCode:(NSData*)dataIn {
    if (dataIn == nil) {
        return nil;
    }
    
    uint8_t digest[CC_SHA256_DIGEST_LENGTH]={0};
    CC_SHA256(dataIn.bytes, dataIn.length, digest);
    NSData *out=[NSData dataWithBytes:digest length:CC_SHA256_DIGEST_LENGTH];
    NSString *hash=[out description];
    hash = [hash stringByReplacingOccurrencesOfString:@&quot; &quot; withString:@&quot;&quot;];
    hash = [hash stringByReplacingOccurrencesOfString:@&quot;&lt;&quot; withString:@&quot;&quot;];
    hash = [hash stringByReplacingOccurrencesOfString:@&quot;&gt;&quot; withString:@&quot;&quot;];
    
    LogD(@&quot;SHA256HashCode : %@&quot;, hash);
    return hash;
}
</code></pre>

<ul>
<li>2ã€è‡ªå®šä¹‰NSURLProtocolä¸­çš„å…³é”®ä»£ç </li>
</ul>

<pre><code class="language-objectivec">+ (BOOL)canInitWithRequest:(NSURLRequest *)request {
    if ([QDCacheManager shouldVerifyHashCode:request]) {
        return YES;
    }
    
    Â·Â·Â· //å…¶å®ƒéœ€è¦ä½¿ç”¨canInitWithRequestçš„é€»è¾‘
    
    return NO;
}

+(NSURLRequest *)canonicalRequestForRequest:(NSURLRequest *)request{
    if ([QDCacheManager shouldVerifyHashCode:request]) {
        return request;
    }
    
    Â·Â·Â·//å…¶å®ƒéœ€è¦ä½¿ç”¨canonicalRequestForRequestçš„é€»è¾‘
    
    return request;
}

- (void)startLoading {
    if ([QDCacheManager shouldVerifyHashCode:self.request]) {
        [[QDCacheManager defaultManager]downloadSourceWithURL:self.request.URL completionBlock:^(NSData *data, NSError *error) {
            if (data == nil || error != nil) {
                [self.client URLProtocol:self didFailWithError:error];
            } else {
                [self.client URLProtocol:self didLoadData:data];
                [self.client URLProtocolDidFinishLoading:self];
            }
        }];
        return;
    }
    Â·Â·Â·//å…¶å®ƒéœ€è¦ä½¿ç”¨startLoadingçš„é€»è¾‘
}
</code></pre>

<h2 id="toc_5">Androidä¸­WebViewå¯¹åº”çš„å…³é”®æ–¹æ³•</h2>

<pre><code class="language-text">@TargetApi(Build.VERSION_CODES.LOLLIPOP)
@Override
public WebResourceResponse shouldInterceptRequest(WebView view, WebResourceRequest request) {
   String url = request.getUrl().toString();
   WebResourceResponse response = loadFromCache(url);
   if (response == null) {
       return super.shouldInterceptRequest(view, request);
   } else {
       return response;
   }
}

public WebResourceResponse shouldInterceptRequest(WebView view, String url) {
    WebResourceResponse response = loadFromCache(url);
    if (response == null) {
        return super.shouldInterceptRequest(view, url);
    } else {
        return response;
    }
}
</code></pre>

			</div>

		
	  
		<footer>
		 <p class="meta">

			<strong>Categories:</strong>&nbsp; 
			<span class="categories">
			
			    <a class='category' href='tech.html'>æŠ€æœ¯</a>&nbsp;
			 
			</span>
		    </p>
		    <p class="meta">
		      
		 </p>
	    
		<div class="sharing">
		  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'billchaiblog';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
          
            <div id="disqus_thread"></div>
          

          

		</div>

	    <p class="meta">
	    
	        <a class="basic-alignment left" href="15378876730780.html" 
	        title="Previous Post: åæ§½ã€Šç››ä¸–çš„è¼èšã€‹">&laquo; åæ§½ã€Šç››ä¸–çš„è¼èšã€‹</a>
	    
	    
	        <a class="basic-alignment right" href="15378876731564.html" 
	        title="Next Post: ã€è½¬ã€‘Awesome Adb">ã€è½¬ã€‘Awesome Adb &raquo;</a>
	    
	    </p>
	  </footer>
	</article>
</div>
 <aside class="sidebar"> 

	<section>
	  <h1>Categories</h1>
	  <ul id="recent_posts">
	  
	      <li class="post">
	        <a href="tech.html"><strong>æŠ€æœ¯&nbsp;(58)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Anything.html"><strong>èƒ¡å†™&nbsp;(16)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="QDaily.html"><strong>QDaily&nbsp;(6)</strong></a>
	        
	        
	        
	      </li>
	   
	  </ul>
	</section>
	<section>
	  <h1>Recent Posts</h1>
	  <ul id="recent_posts">
	  
	      
		      <li class="post">
		        <a href="15498584515544.html">å†™åœ¨19å¹´æ–°å¹´ä¸Šç­ç¬¬ä¸€å¤©</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15446191606030.html">å›¢é˜Ÿç®¡ç†çš„æ„Ÿæ…¨ï¼šä¸è¦è®©æœ‰å…±åŒç‰¹å¾çš„äººèµ°çš„å¤ªè¿‘</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15438122075796.html">å¤´æ¡æµ‹è¯•å†…é“¾</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15407404509104.html">Retro Meeting -> å›¢é˜Ÿçš„è‡ªæˆ‘ç–—ä¼¤</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15379393489219.html">ã€ä»å†å¹´weakçœ‹iOSé¢è¯•ã€‘</a>
		      </li>
	     
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	   
	  </ul>
	</section>
	
</aside> </div></div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 -  -
  <span class="credit">Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; Theme by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>


<script type="text/javascript">
    var disqus_shortname = 'billchaiblog'; 

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
var disqus_shortname = 'billchaiblog'; 

(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = '//' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
  
    




</body>
</html>