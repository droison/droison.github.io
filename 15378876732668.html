
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>
    
  Android Mã€Né€‚é…è¸©å‘ - é‡ç«ğŸ”¥
  

  </title>
  <meta name="author" content="">
  <meta name="description" content="ç”Ÿå‘½å¦‚é‡ç«ï¼Œéª„å‚²è€Œé¡½å¼º">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="asset/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="atom.xml" rel="alternate" title="é‡ç«ğŸ”¥" type="application/atom+xml">
  <script src="asset/js/modernizr-2.0.js"></script>
  <script src="asset/js/jquery.min.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/solarized_light.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>

  <style type="text/css">
  .cat-children-p{ padding: 6px 0px;}
  .hljs{background: none;}
  </style>
  <script type="text/javascript">
  var isAddSildbar = true;
  </script>
  <script src="asset/js/octopress.js" type="text/javascript"></script>
</head>
<script type="text/javascript">
//é“¾æ¥æ–°å¼€çª—å£
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
  });
}
$(document).ready(function(event) {
  addBlankTargetForLinks();
});
</script>
<body   >
  <header role="banner"><hgroup>
  <h1><a href="index.html">é‡ç«ğŸ”¥</a></h1>
  
    <h2>ç”Ÿå‘½å¦‚é‡ç«ï¼Œéª„å‚²è€Œé¡½å¼º</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.chaisong.xyz" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">

  <li id=""><a target="_self" href="index.html">Home</a></li>

  <li id=""><a target="_self" href="archives.html">Archives</a></li>

  <li id=""><a target="_self" href="aboutme.html">ABOUT ME</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content"> 
<div>
	<article class="hentry" role="article">
	<header>
			  	<h1 class="entry-title">Android Mã€Né€‚é…è¸©å‘</h1>
				<p class="meta"><time datetime="2016-11-20T23:01:13+08:00" pubdate data-updated="true">2016/11/20</time></p>
			 </header>
		  	<div class="entry-content">
			  	<blockquote>
<p>æˆ‘ä»¬ä¸Šä¸ªæœˆæ‰å†³å®šå¼€å§‹è¿›è¡ŒAndroid Mã€Nçš„é›†ä¸­é€‚é…ï¼Œå‘ç°å¾ˆå¤šé—®é¢˜ï¼Œåœ¨æ­¤ä¸€èµ·è¿›è¡Œæ€»ç»“ã€‚</p>

<p>é¦–å…ˆæˆ‘ä»¬æŠŠbuildToolsVersionå’ŒcompileSdkVersionéƒ½æ”¹ä¸º24ï¼Œç›¸å…³supportçš„libä¹Ÿéƒ½æ”¹ä¸º24.*ï¼Œä»¥æ­¤æ”¾å¼€äº†é€‚é…ï¼Œé‡ä¸Šäº†å¾ˆå¤šå‘ã€‚</p>

<p>è¿™é‡Œä¸æ˜¯ä¸€ä¸ªå¤§è€Œå…¨çš„é€‚é…æ–¹æ¡ˆï¼Œä»…ä»…æ˜¯ä¸€ä¸ªå°app(å¥½å¥‡å¿ƒæ—¥æŠ¥)çš„é€‚é…æ€»ç»“ã€‚</p>

<p>Android Nçš„é€‚é…ä¸»è¦ä¸ºç»„å†…<a href="https://github.com/yuelinghui">åŒäº‹</a>æ“åˆ€ï¼Œæ‰€ä»¥æ–‡å†…éƒ¨åˆ†å†…å®¹æºäºè¯¥åŒäº‹çš„æ€»ç»“ã€‚</p>

<p>psï¼šæ­¤åç»Ÿä¸€åšå®¢æ–‡ç« çš„è·¯ç”±å‘½åæ–¹å¼ï¼Œæ”¹ä¸ºæ–‡ç« åˆ›è§æ—¶é—´å‘½åï¼Œå¦‚â€œ2016-11-20â€ï¼Œè‹¥å½“å¤©æœ‰ç¬¬äºŒç¯‡åˆ™é¡ºåºå‘½åä¸ºâ€œ2016-11-20-1â€ï¼Œä»¥æ­¤æ¥ç»Ÿä¸€åŒ–ï¼Œé¿å…æœªæ¥è·¯ç”±å¤±æ•ˆé—®é¢˜ã€‚</p>
</blockquote>

<h2 id="toc_0">ä¸€ã€æƒé™é€‚é… -- Android M</h2>

<p>ä½œä¸ºä¸€ä¸ªæ–°é—»ç±»appï¼Œé€‚é…çš„æœ€ä¸»è¦çš„éƒ¨åˆ†åº”è¯¥å°±æ˜¯æƒé™äº†ã€‚<br/>
Android6.0å¼•å…¥äº†åŠ¨æ€æƒé™æ§åˆ¶ï¼Œ7.0ä½¿ç”¨äº†<code>ç§æœ‰ç›®å½•è¢«é™åˆ¶è®¿é—®</code>ï¼Œ<code>Strict Mode API æ”¿ç­–</code>ã€‚<br/>
å› æ­¤æƒé™é€‚é…åŒ…å«appæƒé™è·å–éƒ¨åˆ†å’Œç§æœ‰ç›®å½•è®¿é—®éƒ¨åˆ†ã€‚<br/>
<span id="more"></span><!-- more --></p>

<h3 id="toc_1">1ã€æƒé™ç”³è¯·</h3>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é‡‡ç”¨çš„é€‚é…æ–¹æ¡ˆæ˜¯<code>å…³é”®æƒé™é¢„ç”³è¯·</code>ï¼Œ<code>æ¬¡è¦æƒé™åŠ¨æ€è·å–</code>çš„æ–¹å¼ã€‚è‡³äºä¸ºä»€ä¹ˆè¦ä¸¤è€…ç»“åˆï¼Œä½ è‡ªå·±å»ä½“ä¼šåŸå› ``ã€‚</p>

<h4 id="toc_2">å…ˆè¯´å…³é”®æƒé™é¢„ç”³è¯·</h4>

<p>è¿™é‡Œæˆ‘ä»¬å­¦ä¹ äº†æ”¯ä»˜å®å’Œé¥¿äº†å—é’ˆå¯¹æƒé™çš„å¤„ç†æ–¹å¼ï¼Œå¼€å¯appå°±ç”³è¯·ä¸¤ä¸ªä¸€å®šè¦æ‹¿åˆ°çš„æƒé™ï¼šæœ¬åœ°æ–‡ä»¶è¯»å†™æƒé™å’Œæ‰‹æœºè¯†åˆ«æ ‡è¯†çš„æƒé™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br/>
<img src="http://blog-10057491.file.myqcloud.com/%E5%BC%80%E6%9C%BA%E6%9D%83%E9%99%90%E7%94%B3%E8%AF%B7.png" alt=""/><br/>
å¦‚æœæƒé™æ²¡æœ‰è·å–æˆåŠŸï¼Œæˆ–è€…åæ¥è¢«ç”¨æˆ·è‡ªå·±å…³æ‰ï¼Œé‚£åˆ™å¼¹çª—æç¤ºç”¨æˆ·è¿›è¡Œæ‰‹åŠ¨æƒé™æ‰“å¼€ï¼Œå¦åˆ™appä¸å…è®¸è¿›å…¥è¯•ç”¨ï¼Œå¦‚ä¸‹å›¾ï¼Œç‚¹å‡»åè·³è½¬appçš„æƒé™è®¾å®šç•Œé¢ï¼š<br/>
<img src="http://blog-10057491.file.myqcloud.com/%E6%9C%AA%E8%8E%B7%E5%8F%96%E6%9D%83%E9%99%90%E6%83%85%E5%86%B5.png" alt=""/></p>

<p>æƒé™åˆ¤æ–­åŠç”³è¯·ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œæ‰€æœ‰activityçš„onCreateéƒ½åˆ¤æ–­æ˜¯å¦è·å–äº†å¿…é¡»æƒé™ï¼š</p>

<pre><code class="language-java">if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) {
            // android 6.0åŠä»¥ä¸Šç‰ˆæœ¬
            if (checkSelfPermission(Manifest.permission.READ_PHONE_STATE) != PackageManager.PERMISSION_GRANTED
                    || checkSelfPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {
                // æœ‰æƒé™æ²¡æœ‰æˆäºˆ
                Intent intent = new Intent();
                intent.setClass(this, CheckPermissionActivity.class);
                startActivity(intent);
                finish();
                return;
            }
        }
</code></pre>

<h4 id="toc_3">åŠ¨æ€æƒé™ç”³è¯·</h4>

<p>å…³é”®æ˜¯ä¸€ä¸‹å‡ ä¸ªapi</p>

<ul>
<li>int checkSelfPermission(String permission) ç”¨æ¥æ£€æµ‹åº”ç”¨æ˜¯å¦å·²ç»å…·æœ‰æƒé™</li>
<li>void requestPermissions(String[] permissions, int requestCode) è¿›è¡Œè¯·æ±‚å•ä¸ªæˆ–å¤šä¸ªæƒé™</li>
<li>void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) ç”¨æˆ·å¯¹è¯·æ±‚ä½œå‡ºå“åº”åçš„å›è°ƒ</li>
</ul>

<p><a href="http://droidyue.com/blog/2016/01/17/understanding-marshmallow-runtime-permission/index.html">èŠä¸€èŠAndroid 6.0çš„è¿è¡Œæ—¶æƒé™</a>è¿™ç¯‡æ–‡ç« å†™çš„å·²ç»éå¸¸å¥½äº†ï¼Œä¸éœ€è¦æˆ‘ç»§ç»­åšæ€»ç»“äº†ã€‚</p>

<h3 id="toc_4">2ã€ç§æœ‰ç›®å½•ç›®å½•è®¿é—® -- Android N</h3>

<h4 id="toc_5">ç›®å½•è¢«é™åˆ¶è®¿é—®</h4>

<p>åœ¨Androidä¸­åº”ç”¨å¯ä»¥è¯»å†™æ‰‹æœºå­˜å‚¨ä¸­ä»»ä½•ä¸€ä¸ªç›®å½•å’Œæ–‡ä»¶ï¼Œè¿™ç»™ç³»ç»Ÿå®‰å…¨å¸¦æ¥äº†å¾ˆå¤šé—®é¢˜ã€‚</p>

<p>7.0ä¸­ä¸ºäº†æé«˜ç§æœ‰æ–‡ä»¶çš„å®‰å…¨æ€§ï¼Œé¢å‘7.0åŠæ›´é«˜ç‰ˆæœ¬çš„åº”ç”¨ç§æœ‰ç›®å½•å°†è¢«é™åˆ¶è®¿é—®ã€‚</p>

<p><u>ç»æµ‹è¯•ï¼ŒFile apiåœ¨åº”ç”¨å†…è¯»å–æ–‡ä»¶å­˜å‚¨ä¾ç„¶å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œåº”ç”¨é—´ï¼ˆä¸»è¦æŒ‡è°ƒç”¨éƒ¨åˆ†ç³»ç»Ÿåº”ç”¨ï¼‰è¿›è¡Œå…±äº«ä¼šç›´æ¥æŠ¥é”™ã€‚</u></p>

<ul>
<li><p>ç§æœ‰æ–‡ä»¶çš„æ–‡ä»¶æƒé™ä¸åœ¨æ”¾æƒç»™æ‰€æœ‰çš„åº”ç”¨ï¼Œåœ¨manifesté‡Œä½¿ç”¨<strong>MODE_WORLD_READABLE</strong>æˆ–<strong>MODE_WORL_WRITEABLE</strong>è¿›è¡Œçš„æ“ä½œå°†è§¦å‘<strong>SecurityExceptionã€‚</strong></p></li>
<li><p>ç»™å…¶ä»–åº”ç”¨ä¼ é€’file://URIè¿™ç§URIç±»å‹ï¼Œå¯èƒ½å¯¼è‡´æ¥æ”¶è€…æ— æ³•è®¿é—®è¯¥è·¯å¾„ã€‚å› æ­¤ï¼Œåœ¨7.0ä¸­å°è¯•ä¼ é€’file://URIä¼šè§¦å‘<strong>FileUriExposedExceptionã€‚</strong></p></li>
</ul>

<h3 id="toc_6">åº”ç”¨é—´å…±äº«æ–‡ä»¶</h3>

<p>åœ¨Android7.0ç‰ˆæœ¬ä¸Šï¼ŒAndroidç³»ç»Ÿå¼ºåˆ¶æ‰§è¡Œäº†<strong>StrictMode API æ”¿ç­–</strong>ï¼Œç¦æ­¢å‘ä½ çš„åº”ç”¨å¤–å…¬å¼€File://URIã€‚å¦‚æœä¸€é¡¹åŒ…å«æ–‡ä»¶File://URIç±»å‹çš„Intentç¦»å¼€ä½ çš„åº”ç”¨ï¼Œåº”ç”¨å¤±è´¥ï¼Œå¹¶å‡ºç°<strong>FileUriExposedException</strong>ï¼Œæ¯”å¦‚<strong>ç³»ç»Ÿç›¸æœºæ‹ç…§ï¼Œè£å‰ªç…§ç‰‡</strong></p>

<h4 id="toc_7">åœ¨Android 7.0ç³»ç»Ÿè°ƒç”¨ç›¸æœºæ‹ç…§ï¼Œè£å‰ªç…§ç‰‡</h4>

<p>åœ¨7.0ä¹‹å‰è°ƒç”¨ç³»ç»Ÿç›¸æœºæ‹ç…§ï¼š</p>

<pre><code class="language-text">File file=new File(Environment.getExternalStorageDirectory(),
&quot;/temp/&quot;+System.currentTimeMillis() + &quot;.jpg&quot;); 
if (!file.getParentFile().exists()) {
    file.getParentFile().mkdirs();
}
Uri imageUri = Uri.fromFile(file); 
Intent intent = new Intent();
intent.setAction(MediaStore.ACTION_IMAGE_CAPTURE);//è®¾ç½®Actionä¸ºæ‹ç…§ 
intent.putExtra(MediaStore.EXTRA_OUTPUT, imageUri);//å°†æ‹å–çš„ç…§ç‰‡ä¿å­˜åˆ°æŒ‡å®šURI 
startActivityForResult(intent,1006);
</code></pre>

<p>åœ¨7.0ä¸Šä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p>

<pre><code class="language-text">android.os.FileUriExposedException:file:////storage/emulated/0/temp/1474956193735.jpg exposed beyond app through Intent.getData() 
at android.os.StrictMode.onFileUriExposed(StrictMode.java:1799) 
</code></pre>

<p>è¿™æ˜¯å› ä¸º7.0æ‰§è¡Œäº†â€œStrictMode API æ”¿ç­–â€ã€‚</p>

<p><u>åº”å¯¹ç­–ç•¥ï¼šä½¿ç”¨FilrProvideræ¥è§£å†³è¿™ä¸€ä¸ªé—®é¢˜</u></p>

<h4 id="toc_8">ä½¿ç”¨FileProvider</h4>

<ol>
<li><p>åœ¨manifesté‡Œæ³¨å†Œprovider</p>
<pre><code class="language-text">&lt;provider 
    android:name=&quot;android.support.v4.content.FileProvider&quot;<br/>
    android:authorities=&quot;com.jph.takephoto.fileprovider&quot;<br/>
    android:grantUriPermissions=&quot;true&quot;<br/>
    android:exported=&quot;false&quot;&gt;<br/>
     &lt;meta-data <br/>
        android:name=&quot;android.support.FILE_PROVIDER_PATHS&quot;<br/>
        android:resource=&quot;@xml/file_paths&quot;/&gt; <br/>
&lt;/provider&gt;
</code></pre>
<p><u>exportedå¿…é¡»è¦æ±‚ä¸ºfalseï¼Œä¸ºtrueåˆ™ä¼šæŠ¥å®‰å…¨å¼‚å¸¸ã€‚grantUriPermissionsä¸ºtrueï¼Œè¡¨ç¤ºæˆäºˆURIä¸´æ—¶è®¿é—®æƒé™ã€‚</u></p></li>
<li><p>æŒ‡å®šå…±äº«ç›®å½•</p>
<p>ä¸ºäº†æŒ‡å®šå…±äº«çš„ç›®å½•æˆ‘ä»¬éœ€è¦åœ¨èµ„æºç›®å½•ä¸‹ï¼ˆresï¼‰åˆ›å»ºä¸€ä¸ªxmlç›®å½•ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªåä¸ºâ€œfile_pathsâ€ï¼ˆåå­—å¯ä»¥éšä¾¿èµ·ï¼Œåªè¦å’Œåœ¨manifesté‡Œæ³¨å†Œçš„provideræ‰€å¼•ç”¨çš„resourceä¿æŒä¸€è‡´å³å¯ï¼‰çš„èµ„æºæ–‡ä»¶</p>
<pre><code class="language-text">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;resources&gt;<br/>
    &lt;paths&gt;<br/>
        &lt;external-path path=&quot;&quot; name=&quot;camera_photos&quot; /&gt;<br/>
    &lt;/paths&gt;<br/>
&lt;/resources&gt;
</code></pre>
<ul>
<li>ä»£è¡¨çš„æ ¹ç›®å½•ï¼š Context.getFilesDir()</li>
<li>ä»£è¡¨çš„æ ¹ç›®å½•: Environment.getExternalStorageDirectory()</li>
<li>ä»£è¡¨çš„æ ¹ç›®å½•: getCacheDir()</li>
</ul>
<p><u>path=&quot;&quot;æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå®ƒä»£è¡¨æ ¹ç›®å½•ï¼Œä½ å¯ä»¥å‘å…¶ä»–çš„åº”ç”¨å…±äº«æ ¹ç›®å½•åŠå…¶å­ç›®å½•ä¸‹çš„ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ã€‚è‹¥è®¾ç½®path=&quot;pictures&quot;ï¼Œå®ƒä»£è¡¨ç€æ ¹ç›®å½•ä¸‹çš„picturesç›®å½•ï¼Œé‚£ä¹ˆä½ æƒ³å‘å…¶ä»–åº”ç”¨å…±äº«picturesç›®å½•èŒƒå›´ä¹‹å¤–çš„æ–‡ä»¶æ˜¯ä¸å¯è¡Œçš„ã€‚</u></p></li>
<li><p>ä½¿ç”¨FileProvider</p>
<p>ä¸Šè¿°å·¥ä½œåšå®Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨FileProvideräº†ï¼Œä»¥è°ƒç”¨ç›¸æœºä¸ºä¾‹ï¼š</p>
<pre><code class="language-text">File file=new File(Environment.getExternalStorageDirectory(),
        &quot;/temp/&quot;+System.currentTimeMillis() + &quot;.jpg&quot;);<br/>
if (!file.getParentFile().exists()) {<br/>
    file.getParentFile().mkdirs();<br/>
}<br/>
Uri imageUri = FileProvider.getUriForFile(context,<br/>
    &quot;com.jph.takephoto.fileprovider&quot;, file);//é€šè¿‡FileProvideråˆ›å»ºä¸€ä¸ªcontentç±»å‹çš„Uri<br/>
Intent intent = new Intent();<br/>
intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION); //æ·»åŠ è¿™ä¸€å¥è¡¨ç¤ºå¯¹ç›®æ ‡åº”ç”¨ä¸´æ—¶æˆæƒè¯¥Uriæ‰€ä»£è¡¨çš„æ–‡ä»¶<br/>
intent.setAction(MediaStore.ACTION_IMAGE_CAPTURE);//è®¾ç½®Actionä¸ºæ‹ç…§<br/>
intent.putExtra(MediaStore.EXTRA_OUTPUT, imageUri);//å°†æ‹å–çš„ç…§ç‰‡ä¿å­˜åˆ°æŒ‡å®šURI<br/>
startActivityForResult(intent,1006);
</code></pre>
<p>ä¸Šé¢çš„ä»£ç æœ‰ä¸¤å¤„æ”¹å˜ï¼š</p>
<ol>
<li>å°†ä¹‹å‰Uriçš„schemeç±»å‹ä¸ºfileçš„Uriæ”¹æˆäº†æœ‰FileProvideråˆ›å»ºä¸€ä¸ªcontentç±»å‹çš„Uriã€‚</li>
<li>æ·»åŠ äº†intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);æ¥å¯¹ç›®æ ‡åº”ç”¨ä¸´æ—¶æˆæƒè¯¥Uriæ‰€ä»£è¡¨çš„æ–‡ä»¶ã€‚</li>
</ol>
<p><u>é€šè¿‡FileProviderçš„getUriForFile(Context context, String authority, File file)é™æ€æ–¹æ³•æ¥è·å–URIï¼Œæ–¹æ³•ä¸­çš„authorityå°±æ˜¯manifesté‡Œæ³¨å†Œproviderä½¿ç”¨çš„authorityã€‚</u></p>
<p><u>getUriForFileæ–¹æ³•è¿”å›çš„Uriä¸ºï¼š</u></p>
<pre><code class="language-text">content://com.jph.takephoto.fileprovider/camera_photos/temp/1474960080319.jpg`
</code></pre>
<p>å…¶ä¸­<strong>camera_photos</strong>å°±æ˜¯file_pathsæ–‡ä»¶ä¸­pathsçš„nameã€‚</p></li>
</ol>

<h2 id="toc_9">äºŒã€support lib 24ä¸‹RecyclerViewçš„ä¸€äº›é€‚é…</h2>

<p>åœ¨23åŠä»¥å‰çš„RecyclerViewï¼Œä¼šé»˜è®¤å¿½ç•¥ViewHolderçš„ItemViewçš„layoutParamsï¼Œç›´æ¥ç”¨wrap_contentè¿›è¡Œå¤„ç†ï¼›ä½†åœ¨24ä¸‹ï¼Œé»˜è®¤layoutParamsä¼šå¯¹å…¶è¿›è¡Œæ”¯æŒï¼Œå¦‚æœåœ¨å†™itemçš„xmlæ—¶ä½¿ç”¨äº†match_parentï¼Œä¼šè®©è¯¥itemçš„widthï¼ˆheightï¼‰ç­‰äºRecyclerViewçš„å¯¹åº”widthï¼ˆheightï¼‰ï¼Œå†™æ­»çš„dpå€¼ä¹Ÿä¼šè¢«ä¼˜å…ˆè¯»å–ã€‚è¿™å½“ç„¶æ˜¯ä¸€ç§å¥½çš„ä¼˜åŒ–ï¼Œä½¿å¾—è¿‡å»å¾ˆå¤šéœ€è¦åµŒå¥—æ¥å®ç°çš„ä¸€äº›â€œæ’‘å¼€â€itemçš„æ“ä½œç›´æ¥å†™åœ¨root viewå³å¯ï¼Œä½†ç”±äºæœºåˆ¶çš„ä¿®æ”¹ï¼Œä¸å¯é¿å…ä¼šå‡ºç°é€‚é…çš„é—®é¢˜ï¼ˆå®½é«˜ä¸æƒ³è±¡ä¸­ä¸¥é‡ä¸ä¸€è‡´ï¼‰ã€‚</p>

<p>_æ— è„‘çš„é€‚é…æ–¹æ¡ˆå°±æ˜¯å°†æ‰€æœ‰itemçš„xmlæ–‡ä»¶çš„rootçš„layout_widthå’Œlayout_heightéƒ½æ”¹ä¸ºwrap_contentï¼Œå°±å˜æˆäº†ä¹‹å‰ä¸€æ¨¡ä¸€æ ·çš„æ•ˆæœ_</p>

<p>ä¸è¿‡è¿™é‡Œæˆ‘è¿˜æ˜¯å»ºè®®é’ˆå¯¹itemè¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œå°†åŸæ¥åœ¨ViewHolderåœ°æ–¹è¿›è¡Œçš„å°ºå¯¸è®¡åˆ’é‡æ–°èµ‹äºˆItemView layoutParentå’Œé€šè¿‡åµŒå¥—æ¥å®ç°çš„â€œæ’‘å¼€â€æ“ä½œéƒ½æ”¹ä¸ºåœ¨root viewä¸Šè¿›è¡Œï¼Œå¯ä»¥å‡å°‘ä»£ç é€»è¾‘å’ŒUIå±‚çº§ã€‚</p>

<p>RecyclerViewçš„ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p>

<h2 id="toc_10">ä¸‰ã€support lib 24ä¸‹Notificationçš„ä¸€ç‚¹é€‚é…</h2>

<p>SDK 24 ä¸‹çš„NotificationManager.javaçš„notifyAsUserå‡ºç°äº†ä»¥ä¸‹çš„ä¿®æ”¹ï¼Œå¼ºè¿«6.0åŠä»¥ä¸Šç³»ç»Ÿä¸‹åœ¨ä½¿ç”¨notificationæ—¶ä¸€å®šè¦ä¼ å…¥small iconã€‚æˆ‘ä»¬appä¸­ä»…åœ¨å°ç±³æ‰‹æœºä¸­ç”¨äº†è¿™é‡Œçš„apiè¿›è¡Œæ‰“å¼€appæ¸…ç†æ‰€æœ‰é€šçŸ¥çš„æ“ä½œï¼Œå¯¼è‡´äº†éå¸¸éšè”½çš„crashï¼Œæˆ‘ä»¬appå·®ä¸€ç‚¹ç‚¹å°±æºå¸¦è¿™ä¸ªè‡´å‘½crashä¸Šçº¿äº†ï¼Œç‰¹æ­¤æ ‡è®°ã€‚</p>

<p>å‡ºé”™å †æ ˆï¼š</p>

<pre><code class="language-java">    Caused by:
    java.lang.IllegalArgumentException:Invalid notification (no valid small icon): Notification(pri=0 contentView=com.qdaily.ui/0x1090090 vibrate=null sound=null tick defaults=0x4 flags=0x11 color=0x00000000 vis=PRIVATE)
    android.app.NotificationManager.notify(NotificationManager.java:222)
    android.app.NotificationManager.notify(NotificationManager.java:194)
    ...
</code></pre>

<p>æºä»£ç å¦‚ä¸‹ï¼Œgoogleåœ¨è¿™é‡Œç›´æ¥é‡‡ç”¨throw new IllegalArgumentExceptionçš„æ–¹å¼å®åœ¨å¤ªå±é™©äº†ï¼Œæ„Ÿè§‰è¿™ç§ä»£ç éƒ½æœ‰ç‚¹æ— è¯­ï¼Œåº”è¯¥è®©appå¯ä»¥è®¾ç½®åœ¨DEBUGæ¨¡å¼ä¸‹æ‰throwçš„...</p>

<pre><code class="language-java">    NotificationManager.java
    
    public void notifyAsUser(String tag, int id, Notification notification, UserHandle user)
        {
            ...
            ...
            ...
            if (mContext.getApplicationInfo().targetSdkVersion &gt; Build.VERSION_CODES.LOLLIPOP_MR1) {
                if (notification.getSmallIcon() == null) {
                    throw new IllegalArgumentException(&quot;Invalid notification (no valid small icon): &quot;
                            + notification);
                }
            }
            
            ...
            ...
            ...
        }
</code></pre>

			</div>

		
	  
		<footer>
		 <p class="meta">

			<strong>Categories:</strong>&nbsp; 
			<span class="categories">
			
			    <a class='category' href='QDaily.html'>QDaily</a>&nbsp;
			
			    <a class='category' href='tech.html'>æŠ€æœ¯</a>&nbsp;
			 
			</span>
		    </p>
		    <p class="meta">
		      
		 </p>
	    
		<div class="sharing">
		  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'billchaiblog';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
          
            <div id="disqus_thread"></div>
          

          

		</div>

	    <p class="meta">
	    
	        <a class="basic-alignment left" href="15378876732633.html" 
	        title="Previous Post: RNå­¦ä¹ 4â€”â€”QDaily Android appä¸­é€šä¿¡å’Œçƒ­ä¿®å¤å®è·µ">&laquo; RNå­¦ä¹ 4â€”â€”QDaily Android appä¸­é€šä¿¡å’Œçƒ­ä¿®å¤å®è·µ</a>
	    
	    
	        <a class="basic-alignment right" href="15378876732704.html" 
	        title="Next Post: QDaily appè¿ç»­crashå¤„ç†æ–¹æ¡ˆ">QDaily appè¿ç»­crashå¤„ç†æ–¹æ¡ˆ &raquo;</a>
	    
	    </p>
	  </footer>
	</article>
</div>
 <aside class="sidebar"> 

	<section>
	  <h1>Categories</h1>
	  <ul id="recent_posts">
	  
	      <li class="post">
	        <a href="tech.html"><strong>æŠ€æœ¯&nbsp;(59)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Anything.html"><strong>èƒ¡å†™&nbsp;(16)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="QDaily.html"><strong>QDaily&nbsp;(6)</strong></a>
	        
	        
	        
	      </li>
	   
	  </ul>
	</section>
	<section>
	  <h1>Recent Posts</h1>
	  <ul id="recent_posts">
	  
	      
		      <li class="post">
		        <a href="15613470463264.html">LiveDataç»„ä»¶åˆ†äº«</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15498584515544.html">å†™åœ¨19å¹´æ–°å¹´ä¸Šç­ç¬¬ä¸€å¤©</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15446191606030.html">å›¢é˜Ÿç®¡ç†çš„æ„Ÿæ…¨ï¼šä¸è¦è®©æœ‰å…±åŒç‰¹å¾çš„äººèµ°çš„å¤ªè¿‘</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15438122075796.html">å¤´æ¡æµ‹è¯•å†…é“¾</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15407404509104.html">Retro Meeting -> å›¢é˜Ÿçš„è‡ªæˆ‘ç–—ä¼¤</a>
		      </li>
	     
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	   
	  </ul>
	</section>
	
</aside> </div></div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 -  -
  <span class="credit">Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; Theme by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>


<script type="text/javascript">
    var disqus_shortname = 'billchaiblog'; 

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
var disqus_shortname = 'billchaiblog'; 

(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = '//' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
  
    




</body>
</html>