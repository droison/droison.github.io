
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>
    
  ã€ŠEffective Objective-C 2.0ã€‹è¯»ä¹¦ç¬”è®°1---æ¶ˆæ¯å‘é€ - é‡ç«ğŸ”¥
  

  </title>
  <meta name="author" content="">
  <meta name="description" content="ç”Ÿå‘½å¦‚é‡ç«ï¼Œéª„å‚²è€Œé¡½å¼º">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="asset/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="atom.xml" rel="alternate" title="é‡ç«ğŸ”¥" type="application/atom+xml">
  <script src="asset/js/modernizr-2.0.js"></script>
  <script src="asset/js/jquery.min.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/solarized_light.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>

  <style type="text/css">
  .cat-children-p{ padding: 6px 0px;}
  .hljs{background: none;}
  </style>
  <script type="text/javascript">
  var isAddSildbar = true;
  </script>
  <script src="asset/js/octopress.js" type="text/javascript"></script>
</head>
<script type="text/javascript">
//é“¾æ¥æ–°å¼€çª—å£
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
  });
}
$(document).ready(function(event) {
  addBlankTargetForLinks();
});
</script>
<body   >
  <header role="banner"><hgroup>
  <h1><a href="index.html">é‡ç«ğŸ”¥</a></h1>
  
    <h2>ç”Ÿå‘½å¦‚é‡ç«ï¼Œéª„å‚²è€Œé¡½å¼º</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.chaisong.xyz" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">

  <li id=""><a target="_self" href="index.html">Home</a></li>

  <li id=""><a target="_self" href="archives.html">Archives</a></li>

  <li id=""><a target="_self" href="aboutme.html">ABOUT ME</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content"> 
<div>
	<article class="hentry" role="article">
	<header>
			  	<h1 class="entry-title">ã€ŠEffective Objective-C 2.0ã€‹è¯»ä¹¦ç¬”è®°1---æ¶ˆæ¯å‘é€</h1>
				<p class="meta"><time datetime="2016-03-02T23:01:13+08:00" pubdate data-updated="true">2016/3/2</time></p>
			 </header>
		  	<div class="entry-content">
			  	<blockquote>
<p>objcåœ¨å‡½æ•°è°ƒç”¨é‡‡ç”¨çš„æ˜¯å‘é€æ¶ˆæ¯çš„æ–¹å¼ï¼Œä½¿å¾—è°ƒç”¨æ–¹æ³•åœ¨ç¼–è¯‘å™¨ä¸èƒ½ç¡®å®šï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„runtimeç‰¹æ€§ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼Œobjcçš„å¯¹è±¡ç»“æ„å’Œå…¶æ¶ˆæ¯å‘é€æœºåˆ¶ï¼Œå†³å®šäº†å®ƒçš„runtimeç‰¹æ€§ã€‚</p>
</blockquote>

<h2 id="toc_0">ä¸€ã€Objective-Cå¯¹è±¡ç»“æ„ä½“</h2>

<span id="more"></span><!-- more -->

<p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªï»¿å…·ä½“å®ä¾‹å¯¹è±¡çš„ç»“æ„ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªisaæŒ‡é’ˆï¼ŒæŒ‡å‘å…¶å¯¹åº”çš„Classåœ¨å †å†…å­˜çš„åœ°å€ï¼Œæ¯ä¸ªClassåœ¨å†…å­˜ä¸­ä¿å­˜ä¸€ä¸ªå•ä¾‹ï¼Œè¯¥isaæ­£æ˜¯æŒ‡å‘è¿™ä¸ªå•ä¾‹ã€‚</p>

<pre><code class="language-text">ï»¿ï»¿typedef struct objc_object {
ï»¿   Class isa;
} *id;
</code></pre>

<p>è¯¥ç±»isaæŒ‡é’ˆæŒ‡å‘çš„Classå¯¹è±¡ï¼ˆç±»å¯¹è±¡ï¼‰ä¹Ÿå®šä¹‰åœ¨è¿è¡ŒæœŸç¨‹åºåº“çš„å¤´æ–‡ä»¶ä¸­ï¼š</p>

<pre><code class="language-text">typedef struct objc_class *Class;
struct objc_class {
ï»¿   Class isa;
    Class super_class;
    const char *name;
    struct objc_ivar_list *ivars;
    struct objc_method_list **methodLists;
    struct objc_cache *cache;
    struct objc_protocol_list *protocols;
} *id;
</code></pre>

<p>è¿™ä¸ªClassç»“æ„ä½“å°±å­˜å‚¨ç€ç±»çš„â€œå…ƒæ•°æ®â€ï¼Œå­˜åœ¨isaæŒ‡é’ˆè¯´æ˜è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªOCå¯¹è±¡ï¼ˆåˆ¤æ–­OCå¯¹è±¡çš„æ–¹æ³•å°±æ˜¯isaæŒ‡é’ˆï¼‰ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘è¯¥ç±»çš„metaclassï¼Œè¡¨è¿°ç±»å¯¹è±¡æœ¬èº«æ‰€å…·å¤‡çš„å…ƒæ•°æ®ã€‚</p>

<h4 id="toc_1">æ’æ’­Meta Class</h4>

<p>å¯ä»¥æŠŠmeta classç†è§£ä¸ºä¸€ä¸ªClasså¯¹è±¡çš„Classã€‚ç®€å•çš„è¯´ï¼š</p>

<ul>
<li>å½“æˆ‘ä»¬å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™ä¸€ä¸ªNSObjectå¯¹è±¡æ—¶ï¼Œè¿™æ¡æ¶ˆæ¯ä¼šåœ¨å¯¹è±¡çš„ç±»çš„æ–¹æ³•åˆ—è¡¨é‡ŒæŸ¥æ‰¾</li>
<li>å½“æˆ‘ä»¬å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™ä¸€ä¸ªç±»æ—¶ï¼Œè¿™æ¡æ¶ˆæ¯ä¼šåœ¨ç±»çš„Meta Classçš„æ–¹æ³•åˆ—è¡¨é‡ŒæŸ¥æ‰¾</li>
</ul>

<p>meta classçš„isaæŒ‡é’ˆæŒ‡å‘NSObjectçš„meta classã€‚</p>

<p>ä¸€ä¸ªclassçš„super_classæŒ‡é’ˆæŒ‡å‘å®ƒçˆ¶ç±»çš„classå•ä¾‹åœ°å€ã€‚</p>

<p>meta classçš„super_classæŒ‡é’ˆæŒ‡å‘åŸclassçˆ¶ç±»çš„isaæŒ‡é’ˆæŒ‡å‘çš„meta classã€‚</p>

<p>ä»¥æ­¤å‘ä¸ŠæŸ¥æ‰¾ï¼Œä¸€ç›´æ‰¾åˆ°NSObject(Class) å’Œ Meta Class of NSObjectï¼ŒNSObjectçš„super classæŒ‡å‘nilï¼Œmeta classçš„super classæŒ‡å‘NSObjectï¼Œmeta classçš„isaæŒ‡é’ˆæŒ‡å‘è‡ªå·±ï¼Œå®ç°äº†é€»è¾‘ä¸Šçš„å®Œå–„ã€‚å…·ä½“å…³äºisaæŒ‡é’ˆçš„æŒ‡å‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img src="media/15378876731075/Class-MetaClass.001.jpg" alt="Class-MetaClass.001"/></p>

<h4 id="toc_2">å†æ’æ’­ä¸€æ¡å…³äºClasså†…çœæ–¹æ³•</h4>

<p>isaæŒ‡é’ˆçš„ä¸€ä¸ªå…¸å‹åº”ç”¨å°±æ˜¯ç”¨äºocå¯¹è±¡çš„å†…çœæ–¹æ³•isKindOfå’ŒisMemberOf</p>

<p>isKindOfå°±æ˜¯æ¯”è¾ƒç›®æ ‡ç±»isaæŒ‡é’ˆæˆ–è€…å…¶çˆ¶ç±»<br/>
isaæŒ‡é’ˆæ˜¯å¦å’Œå½“å‰ç±»ä¸€è‡´ï¼š</p>

<pre><code class="language-text">- (BOOL)isKindOf:aClass
{
    Class cls;
    for (cls = isa; cls; cls = cls-&gt;superclass) 
        if (cls == (Class)aClass)
            return YES;
    return NO;
}
</code></pre>

<p>isMemberOfæ›´ä¸ºç²—æš´ï¼Œåªæ¯”è¾ƒå½“å‰ç±»çš„isaæŒ‡é’ˆæ˜¯å¦ä¸€ç›´å³å¯ï¼š</p>

<pre><code class="language-text">- (BOOL)isMemberOf:aClass
{
    return isa == (Class)aClass;
}
</code></pre>

<h4 id="toc_3">æŒ‡å‘ä¿å­˜Classæˆå‘˜å˜é‡çš„ivarsæŒ‡é’ˆ</h4>

<p>objc_ivar_listç»“æ„ä½“å­˜å‚¨ç€objc_ivaræ•°ç»„åˆ—è¡¨ï¼Œä¹Ÿå°±æ˜¯å„ä¸ªæˆå‘˜å˜é‡ï¼ŒClassä¸­ä¿å­˜ç€è¯¥ç»“æ„çš„æŒ‡é’ˆã€‚</p>

<h4 id="toc_4">æŒ‡å‘Classä¸­æ–¹æ³•åˆ—è¡¨æŒ‡é’ˆçš„methodListæŒ‡é’ˆ</h4>

<p>classä¸­å¾—methodListæ˜¯ä¸€ä¸ªæŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œæ‰€ä»¥categoryæ‰èƒ½åœ¨å·²æœ‰çš„ç±»ä¸­æ·»åŠ æ–¹æ³•ï¼Œæ‰èƒ½é€šè¿‡swizzlingåŠ¨æ€äº¤æ¢æ–¹æ³•ï¼Œå¯ä»¥è¯´è¿™ä¸ªmethodListæ˜¯ocä¸­æ¶ˆæ¯å‘é€ã€åŠ¨æ€ç»‘å®šçš„å…³é”®ã€‚å…·ä½“ä½¿ç”¨ä¼šåœ¨ä¸‹æ–‡çš„â€œä¼ é€’æ¶ˆæ¯â€ä»‹ç»ã€‚</p>

<h4 id="toc_5">æŒ‡å‘ä¿å­˜methodæŸ¥è¯¢å†å²çš„cacheæŒ‡é’ˆ</h4>

<p>è¿™ä¸ªæ•°ç»„åˆ—è¡¨ä¸»è¦ç”¨äºä¼˜åŒ–æ¶ˆæ¯åŠ¨æ€æŸ¥æ‰¾ä½¿ç”¨çš„ï¼Œå› ä¸ºæ–¹æ³•è°ƒç”¨å®åœ¨è¿è¡ŒæœŸåŠ¨æ€ç»‘å®šçš„ï¼Œç›¸å¯¹ç¼–è¯‘å™¨ç¡®å®šçš„è¯­è¨€ï¼Œä¸å¯é¿å…ä¼šé™ä½è°ƒç”¨æ•ˆç‡ï¼Œå¢åŠ è°ƒç”¨æ—¶é—´ï¼Œè¯¥æ•°ç»„å°±æ˜¯ä¼˜åŒ–è¯¥ä½¿ç”¨çš„ã€‚å…·ä½“ä½¿ç”¨ä¼šåœ¨ä¸‹æ–‡çš„â€œä¼ é€’æ¶ˆæ¯â€ä»‹ç»ã€‚</p>

<h4 id="toc_6">æŒ‡å‘ä¿å­˜Classå®ç°çš„protocolçš„protocolsæŒ‡é’ˆ</h4>

<h2 id="toc_7">äºŒã€ä¼ é€’æ¶ˆæ¯</h2>

<p>æ ¸å¿ƒå°±æ˜¯ objc_msgSendæ–¹æ³•ï¼š</p>

<pre><code class="language-text">void objc_msgSend(id self, SEL cmd, ...)
</code></pre>

<p>åœ¨æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•° </p>

<pre><code class="language-text">id returnValue = [someObj msgName:parameter]
</code></pre>

<p>ç¼–è¯‘å™¨ä¼šå°†å…¶è½¬åŒ–ä¸ºå¦‚ä¸‹å‡½æ•°</p>

<pre><code class="language-text">id returnValue = objc_msgSend(someObj, @selector(msgName), parameter);
</code></pre>

<p>ç„¶åç¼–è¯‘å™¨ä¼šå¯»æ‰¾someObjä¸­isaæŒ‡é’ˆæŒ‡å‘çš„Classä¸­methodListæŒ‡å‘çš„é‚£ä¸ªæ•°ç»„ï¼Œå¦‚æœæ‰¾åˆ°ç›¸ç¬¦çš„ä»£ç ï¼Œåˆ™å®ç°ï¼Œæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±åœ¨å®ƒçš„ç»§æ‰¿ä½“ç³»ä¸­ç»§ç»­å¯»æ‰¾ï¼ˆæ‰¾super_classæŒ‡å‘çš„Classçš„methodListï¼‰ï¼Œä¸€ç›´æ‰¾åˆ°NSObjectï¼Œå¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±æ‰§è¡Œæ¶ˆæ¯è½¬å‘ï¼ˆä¸‹æ–‡æè¿°ï¼‰ã€‚</p>

<p>æŒ‰ç…§ä¸Šé¢ä»‹ç»çš„æŸ¥æ‰¾è·¯å¾„ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¼šç»è¿‡æ¯”è¾ƒå¤šçš„æ­¥éª¤ï¼Œä¸ºä¼˜åŒ–æŸ¥æ‰¾é¡ºåºï¼Œç³»ç»Ÿä¼šå°†å·²ç»åŒ¹é…çš„IMPç¼“å­˜åˆ°å¿«é€Ÿæ˜ å°„è¡¨é‡Œï¼ˆä¸Šæ–‡çš„cacheï¼‰ã€‚</p>

<p>classçš„methodListä¼šæŠŠselectorçš„åç§°æ˜ å°„åˆ°å®ç°æ–¹æ³•é‡Œï¼Œç³»ç»Ÿçš„æ–¹æ³•ä¼šæ¯”è¾ƒé å‰ï¼Œè‡ªå®šä¹‰çš„(categoryç­‰)æ–¹æ³•ä¼šåœ¨åé¢ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹ä¸ºä»åå¾€å‰æŸ¥æ‰¾ã€‚methodListä¸­å¾—è¿™äº›å®ç°æ–¹æ³•å‡ä»¥å‡½æ•°æŒ‡é’ˆçš„å½¢å¼è¡¨ç¤ºï¼Œå³IMPï¼š</p>

<pre><code class="language-text">id (*IMP)(id, SEL, ...)
</code></pre>

<p>åœ¨OCä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€æ›¿æ¢æ–¹æ³•(method swizzling)ï¼Œå°±æ˜¯é€šè¿‡methodListä¸­å¾—è¿™ç§æ˜ å°„ç‰¹æ€§ï¼Œå°†åŸæ¥selectorçš„åç§°æ˜ å°„çš„IMPå’Œæ–°çš„åšäº¤æ¢ï¼Œè¾¾åˆ°æ›¿æ¢çš„ç›®çš„ã€‚ä¸€èˆ¬æ–°å»ºä¸€ä¸ªæ–¹æ³•å¹¶æ›¿æ¢ç³»ç»Ÿæ–¹æ³•çš„æ­¥éª¤ä¸ºï¼š</p>

<pre><code class="language-text">Method originalMethod = class_getInstanceMethod([UIView class], @selector(setFrame:));
Method swappedMethod = class_getInstanceMethod([UIView class], @selector(setNewFrame:));
method_exchangeImplementations(originalMethod, swappedMethod);
</code></pre>

<h4 id="toc_8">æ•´ç†ä¸€ä¸‹æ¶ˆæ¯ä¼ é€’çš„æµç¨‹</h4>

<ol>
<li>æ£€æŸ¥selectoræ˜¯å¦éœ€è¦å¿½ç•¥ã€‚(ps: Macå¼€å‘ä¸­å¼€å¯GCå°±ä¼šå¿½ç•¥retain,releaseæ–¹æ³•ã€‚)</li>
<li>æ£€æŸ¥targetæ˜¯å¦ä¸ºnilã€‚å¦‚æœä¸ºnilï¼Œç›´æ¥cleanupï¼Œç„¶åreturnã€‚(è¿™å°±æ˜¯æˆ‘ä»¬å¯ä»¥å‘nilå‘é€æ¶ˆæ¯çš„åŸå› ã€‚)</li>
<li>ç„¶ååœ¨targetçš„Classä¸­æ ¹æ®Selectorå»æ‰¾IMP</li>
</ol>

<p>å…·ä½“å¯»æ‰¾IMPçš„è¿‡ç¨‹:</p>

<ol>
<li>å…ˆä»å½“å‰classçš„cacheæ–¹æ³•åˆ—è¡¨ï¼ˆcache methodListsï¼‰é‡Œå»æ‰¾</li>
<li>æ‰¾åˆ°äº†ï¼Œè·³åˆ°å¯¹åº”å‡½æ•°å®ç°</li>
<li>æ²¡æ‰¾åˆ°ï¼Œå°±ä»classçš„æ–¹æ³•åˆ—è¡¨ï¼ˆmethodListsï¼‰é‡Œæ‰¾</li>
<li>è¿˜æ‰¾ä¸åˆ°ï¼Œå°±åˆ°super classçš„æ–¹æ³•åˆ—è¡¨é‡Œæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°åŸºç±»(NSObject)ä¸ºæ­¢</li>
<li>æœ€åå†æ‰¾ä¸åˆ°ï¼Œå°±ä¼šè¿›å…¥åŠ¨æ€æ–¹æ³•è§£æå’Œæ¶ˆæ¯è½¬å‘çš„æœºåˆ¶ã€‚(ç¬¬ä¸‰éƒ¨åˆ†ä»‹ç»)</li>
</ol>

<h4 id="toc_9">categoryåŒåæ–¹æ³•çš„è°ƒç”¨é—®é¢˜</h4>

<p>æˆ‘ä»¬æ˜¯å¯ä»¥ä½¿ç”¨categoryå®šä¹‰å’ŒåŸClassä¸­å¾—ç›¸åŒæ–¹æ³•ï¼Œè¿™äº›methodä¼šæ·»åŠ åˆ°Classçš„methodListæ•°ç»„åˆ—è¡¨åº•éƒ¨ï¼Œæ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œä¼šä»åæŸ¥æ‰¾ï¼Œç›¸å½“äºè¦†å†™äº†ç³»ç»Ÿæ–¹æ³•ã€‚</p>

<p>å¦‚æœä¸¤ä¸ªcategoryå®šä¹‰äº†åŒåçš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¹Ÿéƒ½ä¼šæ·»åŠ åˆ°methodListä¸­ï¼Œæ·»åŠ é¡ºåºä¸ºBuild Phasesä¸­Compiles Sourcesä¸­çš„æ–‡ä»¶é¡ºåºï¼Œåå¢åŠ è¿›å»çš„ä¼šè¢«è°ƒç”¨ï¼Œç›¸å½“äºè¦†å†™ã€‚</p>

<h2 id="toc_10">ä¸‰ã€æ¶ˆæ¯è½¬å‘</h2>

<p>æ¶ˆæ¯è½¬å‘å‘ç”Ÿåœ¨ä¸Šé¢ç¬¬äºŒæ­¥ä¸€ç›´åˆ°æŸ¥æ‰¾åˆ°NSObjectå¾—methodListä¾ç„¶æ²¡æ‰¾åˆ°å¯¹åº”IMPçš„æƒ…å†µä»¥åï¼Œåœ¨æˆ‘ä»¬ä¸€èˆ¬æ”¶åˆ°â€œunrecognized selector sent to instance 0x97â€è¿™ç§å¼‚å¸¸ä¹‹å‰ã€‚è¿™ä¸ªå¼‚å¸¸æ˜¯NSObjectçš„â€œdoesNotRecognizeSelector:â€æ–¹æ³•æŠ›å‡ºçš„ã€‚</p>

<h3 id="toc_11">ï¼ˆ1ï¼‰å…ˆæ•™ç§‘ä¹¦ä¸‹æ¶ˆæ¯è½¬å‘è¿‡ç¨‹</h3>

<ol>
<li><code>åŠ¨æ€æ–¹æ³•è§£æ</code>(Dynamic Method Resolutionæˆ–Lazy method resolution)<br/>
å‘å½“å‰ç±»(Class)å‘é€resolveInstanceMethod:(å¯¹äºç±»æ–¹æ³•åˆ™ä¸ºresolveClassMethod:)æ¶ˆæ¯ï¼Œå¦‚æœè¿”å›YESï¼Œåˆ™ç³»ç»Ÿè®¤ä¸ºè¯·æ±‚çš„æ–¹æ³•å·²ç»åŠ å…¥åˆ°äº†ï¼Œåˆ™ä¼šé‡æ–°å‘é€æ¶ˆæ¯ã€‚</li>
<li><code>å¿«é€Ÿè½¬å‘è·¯å¾„</code>(Fast forwarding path)<br/>
è‹¥æœå½“å‰targetå®ç°äº†forwardingTargetForSelector:æ–¹æ³•ï¼Œåˆ™è°ƒç”¨æ­¤æ–¹æ³•ã€‚å¦‚æœæ­¤æ–¹æ³•è¿”å›é™¤nilå’Œselfçš„å…¶ä»–å¯¹è±¡ï¼Œåˆ™å‘è¿”å›å¯¹è±¡é‡æ–°å‘é€æ¶ˆæ¯ã€‚</li>
<li><code>æ…¢é€Ÿè½¬å‘è·¯å¾„</code>(Normal forwarding path)<br/>
é¦–å…ˆruntimeå‘é€methodSignatureForSelector:æ¶ˆæ¯æŸ¥çœ‹Selectorå¯¹åº”çš„æ–¹æ³•ç­¾åï¼Œå³å‚æ•°ä¸è¿”å›å€¼çš„ç±»å‹ä¿¡æ¯ã€‚å¦‚æœæœ‰æ–¹æ³•ç­¾åè¿”å›ï¼Œruntimeåˆ™æ ¹æ®æ–¹æ³•ç­¾ååˆ›å»ºæè¿°è¯¥æ¶ˆæ¯çš„NSInvocationï¼Œå‘å½“å‰å¯¹è±¡å‘é€forwardInvocation:æ¶ˆæ¯ï¼Œä»¥åˆ›å»ºçš„NSInvocationå¯¹è±¡ä½œä¸ºå‚æ•°ï¼›è‹¥methodSignatureForSelector:æ— æ–¹æ³•ç­¾åè¿”å›ï¼Œåˆ™å‘å½“å‰å¯¹è±¡å‘é€doesNotRecognizeSelector:æ¶ˆæ¯,ç¨‹åºæŠ›å‡ºå¼‚å¸¸é€€å‡ºã€‚</li>
</ol>

<h4 id="toc_12">æ‰€æœ‰ç›¸å…³çš„æ–¹æ³•åŒ…æ‹¬ï¼š</h4>

<h5 id="toc_13">æ–¹æ¡ˆä¸€ï¼š</h5>

<pre><code class="language-text">+ (BOOL)resolveInstanceMethod:(SEL)sel
+ (BOOL)resolveClassMethod:(SEL)sel 
</code></pre>

<p>å¦‚æ–¹æ³•å¯è§ï¼Œæ–¹æ¡ˆä¸€çš„æ‡’åŠ è½½ä¸ºé™æ€æ–¹æ³•ï¼Œå°±æ˜¯ç”¨äºå¯¹ç±»è¿›è¡ŒåŠ¨æ€æ·»åŠ å¯¹åº”IMPï¼Œä¸ç®—æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„è½¬å‘æ¶ˆæ¯ï¼Œåªæ˜¯è¿›è¡Œæœªæ‰¾åˆ°selectorçš„ç¬¬ä¸€ä¸ªè§£å†³åŠæ³•ï¼Œä¼šç›´æ¥ä¿®æ”¹ç±»å¯¹è±¡ï¼Œåœ¨æ‰€æœ‰çš„è¯¥ç±»çš„å­ç±»éƒ½ä¼šè¿›è¡Œä¿®æ”¹ã€‚ä¸€èˆ¬é’ˆå¯¹<code>@dynamic</code>æ ‡è®°çš„å˜é‡è¿›è¡ŒåŠ¨æ€æ·»åŠ getå’Œsetæ–¹æ³•åœ¨è¿™é‡Œè¿›è¡Œå¤„ç†ã€‚</p>

<h5 id="toc_14">æ–¹æ¡ˆäºŒï¼š</h5>

<pre><code class="language-text">- (id)forwardingTargetForSelector:(SEL)aSelector
</code></pre>

<p>æ–¹æ¡ˆäºŒå¤šæ•°æ˜¯å¿«é€Ÿè½¬å‘ï¼Œå°†æ¶ˆæ¯åŸå°ä¸åŠ¨çš„è½¬å‘ç»™å¦ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€èˆ¬ç”¨äºå®ç°ä¼ªå¤šç»§æ‰¿ã€‚</p>

<h5 id="toc_15">æ–¹æ¡ˆä¸‰ï¼š</h5>

<pre><code class="language-text">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector;
- (void)forwardInvocation:(NSInvocation *)anInvocation;
</code></pre>

<p>å¦‚æœæ–¹æ¡ˆä¸€å’ŒäºŒéƒ½æ²¡èµ°é€šï¼Œå°±ä¼šèµ°ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚æ­¤å¤„ä¼šåˆ›å»ºä¸€ä¸ªNSInvocationå¯¹è±¡ï¼Œé‡Œé¢åŒ…å«targetå’Œselectorä»¥åŠæ‰€æœ‰çš„å‚æ•°å’Œè¿”å›å€¼ã€‚</p>

<p>ç”±äºæ„å»ºNSInvocationä¼šå…ˆéœ€è¦ä¸€ä¸ªNSMethodSignatureï¼Œè¿™ä¸ªç­¾åæ˜¯æè¿°è¿™ä¸ªselectorçš„è¿”å›å€¼å’Œå‚æ•°çš„ï¼Œå®Œæ•´çš„æ¶ˆæ¯è½¬å‘å¿…é¡»ç”Ÿæˆç­¾åï¼Œå¦‚æœç­¾åä¸ºnilå°±ä¼šå‡ºç°â€œunrecognized selector sent to instanceâ€çš„é”™è¯¯ã€‚</p>

<p>åœ¨forwardInvocationä¸­æ‹¿åˆ°NSInvocationå¯¹è±¡åï¼Œå¯ä»¥éšæ„ä¿®æ”¹å…¶å‚æ•°ã€selectoræˆ–è€…å¯¹è±¡ã€‚</p>

<p>å®Œæ•´çš„è½¬å‘æµç¨‹å¦‚ä¸‹æ‰€ç¤º:</p>

<p><img src="media/15378876731075/Class$msgSend.png" alt="Class$msgSend"/></p>

<h3 id="toc_16">ï¼ˆ2ï¼‰NSProxy</h3>

<p>æ¶ˆæ¯è½¬å‘ä¸­å¾—å¿«é€Ÿè½¬å‘ä¸€ä¸ªæ¯”è¾ƒå¤§å¾—ä½ åº”ç”¨åœºæ™¯å°±æ˜¯å¤šä»£ç†å’Œå¤šç»§æ‰¿ã€‚</p>

<p>Objective-Cä¸­æœ‰ä¸¤ä¸ªæ ¹ç±»ï¼Œä¸€ä¸ªæ˜¯NSObjectï¼Œå¦ä¸€ä¸ªå°±æ˜¯è¿™ä¸ªNSProxyã€‚</p>

<p>å‚è€ƒï¼š</p>

<p><a href="http://chun.tips/blog/2014/11/06/bao-gen-wen-di-objective%5Bnil%5Dc-runtime(3)%5Bnil%5D-xiao-xi-he-category/">http://chun.tips/blog/2014/11/06/bao-gen-wen-di-objective[nil]c-runtime(3)[nil]-xiao-xi-he-category/</a></p>

<p><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535">http://blog.csdn.net/yanghua_kobe/article/details/8395535</a></p>

<p><a href="http://tutuge.me/2015/02/16/%E5%88%A9%E7%94%A8NSProxy%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91-%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3%E5%B1%82%E8%AE%BE%E8%AE%A1-%E5%8E%9F%E5%88%9B/">http://tutuge.me/2015/02/16/åˆ©ç”¨NSProxyå®ç°æ¶ˆæ¯è½¬å‘-æ¨¡å—åŒ–çš„ç½‘ç»œæ¥å£å±‚è®¾è®¡-åŸåˆ›/</a></p>

			</div>

		
	  
		<footer>
		 <p class="meta">

			<strong>Categories:</strong>&nbsp; 
			<span class="categories">
			
			    <a class='category' href='tech.html'>æŠ€æœ¯</a>&nbsp;
			 
			</span>
		    </p>
		    <p class="meta">
		      
		 </p>
	    
		<div class="sharing">
		  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'billchaiblog';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
          
            <div id="disqus_thread"></div>
          

          

		</div>

	    <p class="meta">
	    
	        <a class="basic-alignment left" href="15378876731044.html" 
	        title="Previous Post: ã€ŠEffective Objective-C 2.0ã€‹è¯»ä¹¦ç¬”è®°3---tips">&laquo; ã€ŠEffective Objective-C 2.0ã€‹è¯»ä¹¦ç¬”è®°3---tips</a>
	    
	    
	        <a class="basic-alignment right" href="15378876731602.html" 
	        title="Next Post: SDWebImageæºç ç ”ç©¶ä¸å­¦ä¹ ">SDWebImageæºç ç ”ç©¶ä¸å­¦ä¹  &raquo;</a>
	    
	    </p>
	  </footer>
	</article>
</div>
 <aside class="sidebar"> 

	<section>
	  <h1>Categories</h1>
	  <ul id="recent_posts">
	  
	      <li class="post">
	        <a href="tech.html"><strong>æŠ€æœ¯&nbsp;(57)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Anything.html"><strong>èƒ¡å†™&nbsp;(12)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="QDaily.html"><strong>QDaily&nbsp;(6)</strong></a>
	        
	        
	        
	      </li>
	   
	  </ul>
	</section>
	<section>
	  <h1>Recent Posts</h1>
	  <ul id="recent_posts">
	  
	      
		      <li class="post">
		        <a href="15378876730248.html">é¢è¯•å¸¸è§ï¼šiOS Category</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15378876732043.html">-[UIImage imageNamed:]æ–¹æ³•å¯¼è‡´çš„å¡é¡¿ä¼˜åŒ–</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15378876732077.html">å¤æ‚å¤šäººé¡¹ç›®Owneræ€è€ƒ</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15378876732116.html">ã€IGListKitã€‘å­¦ä¹ ä¸åˆ†æ2</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15378876732151.html">ã€IGListKitã€‘ListDiff å­¦ä¹ ä¸åˆ†æ1</a>
		      </li>
	     
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	   
	  </ul>
	</section>
	
</aside> </div></div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 -  -
  <span class="credit">Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; Theme by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>


<script type="text/javascript">
    var disqus_shortname = 'billchaiblog'; 

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
var disqus_shortname = 'billchaiblog'; 

(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = '//' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
  
    




</body>
</html>